<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>BLE | Documentation</title>
    <meta name="description" content="Your guide to RTLOC&#39;s positioning products">
    <link rel="icon" href="/img/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#095A9E">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#095A9E">
  <meta name="msapplication-TileImage" content="/icons/mstile-150x150.png">
  <meta name="msapplication-TileColor" content="#000000">
  <script>!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t,e){var n=document.createElement("script");n.type="text/javascript";n.async=!0;n.src="https://cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(n,a);analytics._loadOptions=e};analytics.SNIPPET_VERSION="4.1.0";
    analytics.load("6B7vSa8ecCLBUEiWTPbvB5xNfm9aMMSE");
    analytics.page();
    }}();</script>
    
    <link rel="preload" href="/assets/css/0.styles.f4681fd9.css" as="style"><link rel="preload" href="/assets/js/app.5c9a409e.js" as="script"><link rel="preload" href="/assets/js/4.3a034228.js" as="script"><link rel="preload" href="/assets/js/12.4190be1d.js" as="script"><link rel="preload" href="/assets/js/28.72a68e7b.js" as="script"><link rel="prefetch" href="/assets/js/1.d348f952.js"><link rel="prefetch" href="/assets/js/10.78d8cfed.js"><link rel="prefetch" href="/assets/js/11.97542590.js"><link rel="prefetch" href="/assets/js/13.9157946b.js"><link rel="prefetch" href="/assets/js/14.b003cc95.js"><link rel="prefetch" href="/assets/js/15.eeed7753.js"><link rel="prefetch" href="/assets/js/16.9c8b3052.js"><link rel="prefetch" href="/assets/js/17.cda06e6e.js"><link rel="prefetch" href="/assets/js/18.1218ce2c.js"><link rel="prefetch" href="/assets/js/19.57a836fd.js"><link rel="prefetch" href="/assets/js/2.a090f902.js"><link rel="prefetch" href="/assets/js/20.e43cf93b.js"><link rel="prefetch" href="/assets/js/21.808f51b4.js"><link rel="prefetch" href="/assets/js/22.64fddfae.js"><link rel="prefetch" href="/assets/js/23.74df12f9.js"><link rel="prefetch" href="/assets/js/24.4da89d00.js"><link rel="prefetch" href="/assets/js/25.ac23388a.js"><link rel="prefetch" href="/assets/js/26.04cf0570.js"><link rel="prefetch" href="/assets/js/27.3677b4de.js"><link rel="prefetch" href="/assets/js/29.b88cfbbd.js"><link rel="prefetch" href="/assets/js/30.884c5607.js"><link rel="prefetch" href="/assets/js/31.1ebf2d71.js"><link rel="prefetch" href="/assets/js/32.4356597d.js"><link rel="prefetch" href="/assets/js/33.c356ff2f.js"><link rel="prefetch" href="/assets/js/34.f8166a1c.js"><link rel="prefetch" href="/assets/js/35.42bab231.js"><link rel="prefetch" href="/assets/js/36.49a49190.js"><link rel="prefetch" href="/assets/js/37.cbb07ac8.js"><link rel="prefetch" href="/assets/js/38.813b086d.js"><link rel="prefetch" href="/assets/js/39.6533b601.js"><link rel="prefetch" href="/assets/js/40.ba45cf57.js"><link rel="prefetch" href="/assets/js/41.37f8273e.js"><link rel="prefetch" href="/assets/js/42.4d51ddaa.js"><link rel="prefetch" href="/assets/js/43.c6220f9f.js"><link rel="prefetch" href="/assets/js/44.460d5341.js"><link rel="prefetch" href="/assets/js/45.22f96577.js"><link rel="prefetch" href="/assets/js/46.53cafe89.js"><link rel="prefetch" href="/assets/js/47.e7ccc421.js"><link rel="prefetch" href="/assets/js/48.3b9d8e6d.js"><link rel="prefetch" href="/assets/js/49.04af4d4a.js"><link rel="prefetch" href="/assets/js/5.2909c194.js"><link rel="prefetch" href="/assets/js/50.a0bdf965.js"><link rel="prefetch" href="/assets/js/51.edd28156.js"><link rel="prefetch" href="/assets/js/52.d4a3b710.js"><link rel="prefetch" href="/assets/js/53.04b39236.js"><link rel="prefetch" href="/assets/js/54.81620729.js"><link rel="prefetch" href="/assets/js/55.7bf9f040.js"><link rel="prefetch" href="/assets/js/56.4de7d5f0.js"><link rel="prefetch" href="/assets/js/57.b60c6835.js"><link rel="prefetch" href="/assets/js/58.77910637.js"><link rel="prefetch" href="/assets/js/59.1aa7ff99.js"><link rel="prefetch" href="/assets/js/6.5755ad1f.js"><link rel="prefetch" href="/assets/js/60.e9a6bf41.js"><link rel="prefetch" href="/assets/js/61.c9329aad.js"><link rel="prefetch" href="/assets/js/62.2faf3620.js"><link rel="prefetch" href="/assets/js/63.b6f31d2a.js"><link rel="prefetch" href="/assets/js/64.6a84b2f7.js"><link rel="prefetch" href="/assets/js/65.0aef7e03.js"><link rel="prefetch" href="/assets/js/66.6bcf90cf.js"><link rel="prefetch" href="/assets/js/67.cfda4a02.js"><link rel="prefetch" href="/assets/js/68.3023df8f.js"><link rel="prefetch" href="/assets/js/69.08e912c2.js"><link rel="prefetch" href="/assets/js/7.9c7c64bc.js"><link rel="prefetch" href="/assets/js/70.d88eeb6d.js"><link rel="prefetch" href="/assets/js/71.769adff5.js"><link rel="prefetch" href="/assets/js/72.20f8a538.js"><link rel="prefetch" href="/assets/js/73.d8fd969c.js"><link rel="prefetch" href="/assets/js/74.7ca6d605.js"><link rel="prefetch" href="/assets/js/75.b1f646c5.js"><link rel="prefetch" href="/assets/js/76.a7d832fa.js"><link rel="prefetch" href="/assets/js/77.29aff629.js"><link rel="prefetch" href="/assets/js/78.81a32dc1.js"><link rel="prefetch" href="/assets/js/79.7e3d9dc6.js"><link rel="prefetch" href="/assets/js/8.1b2c21f7.js"><link rel="prefetch" href="/assets/js/80.e890a809.js"><link rel="prefetch" href="/assets/js/81.bcd2857b.js"><link rel="prefetch" href="/assets/js/82.d356f50b.js"><link rel="prefetch" href="/assets/js/83.7c347a04.js"><link rel="prefetch" href="/assets/js/84.1c189765.js"><link rel="prefetch" href="/assets/js/85.307f14a6.js"><link rel="prefetch" href="/assets/js/86.a629bd79.js"><link rel="prefetch" href="/assets/js/87.5f985e93.js"><link rel="prefetch" href="/assets/js/88.e219665f.js"><link rel="prefetch" href="/assets/js/89.bb704793.js"><link rel="prefetch" href="/assets/js/9.81ec1d48.js"><link rel="prefetch" href="/assets/js/90.80958674.js"><link rel="prefetch" href="/assets/js/91.44221fa5.js"><link rel="prefetch" href="/assets/js/92.eacd3c17.js"><link rel="prefetch" href="/assets/js/93.9c8b5e7c.js"><link rel="prefetch" href="/assets/js/94.83374c54.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f4681fd9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/getstarted/" class="nav-link">Get Started</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="System guide" class="dropdown-title"><span class="title">System guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link">Introduction</a></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hub/" class="nav-link">Hub</a></li><li class="dropdown-subitem"><a href="/manager/" class="nav-link">Manager</a></li><li class="dropdown-subitem"><a href="/web/" class="nav-link">Portal (web)</a></li><li class="dropdown-subitem"><a href="/hardware/" class="nav-link router-link-active">Embedded/Hardware</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/api/" class="nav-link">API</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Learn more" class="dropdown-title"><span class="title">Learn more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/reference/" class="nav-link">System Reference</a></li><li class="dropdown-item"><!----> <a href="/faq/faq_general.html" class="nav-link">FAQ</a></li><li class="dropdown-item"><!----> <a href="/troubleshoot/" class="nav-link">Troubleshoot</a></li></ul></div></div><div class="nav-item"><a href="https://rtloc.com/ticket" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Support
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/getstarted/" class="nav-link">Get Started</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="System guide" class="dropdown-title"><span class="title">System guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link">Introduction</a></li><li class="dropdown-item"><h4></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hub/" class="nav-link">Hub</a></li><li class="dropdown-subitem"><a href="/manager/" class="nav-link">Manager</a></li><li class="dropdown-subitem"><a href="/web/" class="nav-link">Portal (web)</a></li><li class="dropdown-subitem"><a href="/hardware/" class="nav-link router-link-active">Embedded/Hardware</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/api/" class="nav-link">API</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Learn more" class="dropdown-title"><span class="title">Learn more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/reference/" class="nav-link">System Reference</a></li><li class="dropdown-item"><!----> <a href="/faq/faq_general.html" class="nav-link">FAQ</a></li><li class="dropdown-item"><!----> <a href="/troubleshoot/" class="nav-link">Troubleshoot</a></li></ul></div></div><div class="nav-item"><a href="https://rtloc.com/ticket" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Support
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Building &amp; Flashing</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Interfaces</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hardware/hw_interface_ble.html" class="active sidebar-link">BLE</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hardware/hw_interface_ble.html#some-more-details-on-ble" class="sidebar-link">Some more details on BLE</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hardware/hw_interface_ble.html#gap-role-central-vs-peripheral" class="sidebar-link">GAP Role (Central vs Peripheral)</a></li><li class="sidebar-sub-header"><a href="/hardware/hw_interface_ble.html#gatt" class="sidebar-link">GATT</a></li></ul></li><li class="sidebar-sub-header"><a href="/hardware/hw_interface_ble.html#bluefruit" class="sidebar-link">BlueFruit</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hardware/hw_interface_ble.html#make-a-connection" class="sidebar-link">Make a connection</a></li><li class="sidebar-sub-header"><a href="/hardware/hw_interface_ble.html#receiving-data" class="sidebar-link">Receiving data</a></li><li class="sidebar-sub-header"><a href="/hardware/hw_interface_ble.html#exporting-data" class="sidebar-link">Exporting data</a></li></ul></li></ul></li><li><a href="/hardware/hw_interface_usb.html" class="sidebar-link">USB</a></li><li><a href="/hardware/hw_interface_uart.html" class="sidebar-link">UART</a></li><li><a href="/hardware/hw_interface_can.html" class="sidebar-link">CAN</a></li><li><a href="/hardware/hw_interface_sniffer.html" class="sidebar-link">Sniffer</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ble"><a href="#ble" class="header-anchor">#</a> BLE</h1> <p>Receive data from the mobile tags on your phone or tablet. This data is transmitted via a BLE connection. In order to make the connection and see the data, you will need to download an app that supports the correct BLE service.</p> <h2 id="some-more-details-on-ble"><a href="#some-more-details-on-ble" class="header-anchor">#</a> Some more details on BLE</h2> <p>Data is transmitted via BLE. BLE is not designed for high throughput of data, so we need to be careful with the amount of data we send. Some important concepts are the GAP Role and the GATT Profile with its services &amp; characteristics.</p> <h3 id="gap-role-central-vs-peripheral"><a href="#gap-role-central-vs-peripheral" class="header-anchor">#</a> GAP Role (Central vs Peripheral)</h3> <p>We need to distinguish the so called GAP (generic access profile) role. There are 2 roles: central and peripheral. A Peripheral can advertise to let others know it's there. It can however not establish a connection. This is always done by a Central, which can send connection requests. You can see the Central as the master and the Peripheral as the slave.</p> <p>In our system, the tag serves as peripheral and the phone/tablet with the app as central.
So in the app you can see all tags that are advertising in the neighborhood, and make connections with them. After making a connection, data can be exchanged.</p> <h3 id="gatt"><a href="#gatt" class="header-anchor">#</a> GATT</h3> <p>The GATT Profile is defined as follows:</p> <div class="language- extra-class"><pre class="language-text"><code>The GATT Profile specifies the structure in which profile data is exchanged. This structure defines basic elements such as Services and Characteristics, used in a profile.
</code></pre></div><p>We need to have a service that allows us to exchange at least the distances (and possibly other data).</p> <h4 id="nordic-uart-service-nus"><a href="#nordic-uart-service-nus" class="header-anchor">#</a> Nordic UART Service (NUS)</h4> <p>The NUS is a proprietary BLE service that mimics UART over Bluetooth. This means essentially that we can send any arrays of data up and down via the RX and TX datachannel.</p> <p>You can send any kind of data, so we can send strings of readable text, or encode the data via a binary protocol.</p> <h4 id="tailored-service"><a href="#tailored-service" class="header-anchor">#</a> Tailored Service</h4> <p>In order to optimally make use of the BLE, we need to make a service especially made for this problem. This has not been done yet however, and until then we'll make use of the NUS. Whenever the custom service is ready, we will also need a custom app to display the data.</p> <h2 id="bluefruit"><a href="#bluefruit" class="header-anchor">#</a> BlueFruit</h2> <p>BlueFruit is a free app from Adafruit, available on iOS and android, that supports the NUS. Search for 'BlueFruit' in the appstore or the google store and download the app.</p> <p><img src="/assets/img/ble_nus_bluefruit_download.e11da2a6.png" alt="bluefruit ios" title="BlueFruit in iOS"></p> <h3 id="make-a-connection"><a href="#make-a-connection" class="header-anchor">#</a> Make a connection</h3> <p>When you open the app, it will have the correct predefined settings. The app is set in Central mode, and it will show all Peripherals (in other words: the tags) that are advertising the UART service. Whenever you have some tags running, you should see something like this:</p> <p><img src="/assets/img/ble_nus_bluefruit_1.494e2520.png" alt="bluefruit 1" title="BlueFruit 1"></p> <p>If you don't see the tags, try to reset the tag and/or the Bluetooth connection on your phone/tablet.</p> <p>Now press connect on the tag of choice. It will show you the following:</p> <p><img src="/assets/img/ble_nus_bluefruit_2.e9144847.png" alt="bluefruit connect" title="BlueFruit connect"></p> <p><img src="/assets/img/ble_nus_bluefruit_3.126ea7a9.png" alt="bluefruit connected" title="BlueFruit connected"></p> <p><code>Note:</code> we will only make use of the UART module of this app. You can ignore the other modules.</p> <h3 id="receiving-data"><a href="#receiving-data" class="header-anchor">#</a> Receiving data</h3> <p>After pressing 'UART', you will see a console with data coming in (and out if you want to send something to the tag).
The data is shown in ASCII-format so that it's readable. Each dataframe has the following format (for now.. it sucks and will be changed soon with a binary format 😃. ):</p> <div class="language- extra-class"><pre class="language-text"><code>[framenumber]) [tagid1] &gt;&gt; [distance1] || [tagid2] &gt;&gt; [distance2] || ...
</code></pre></div><p>The distances are in centimeter and represent the measured distance between the tag you made the BLE connection with and the tag with ID shown before the '&gt;&gt;'</p> <p><img src="/assets/img/ble_nus_bluefruit_4.13ad6321.png" alt="bluefruit data" title="BlueFruit data"></p> <p>In the screenshot you see a how it can look like when a tag is ranging with 7 other tags.</p> <h3 id="exporting-data"><a href="#exporting-data" class="header-anchor">#</a> Exporting data</h3> <p>BlueFruit has the nice feature that you can export the data. Press the gear in the right upper corner to show the settings menu.</p> <p><img src="/assets/img/ble_nus_bluefruit_5.3966f43c.png" alt="bluefruit data" title="BlueFruit data"></p> <p>When you press 'Export', you will see the different supported formats: <code>txt</code>, <code>csv</code>, <code>json</code> and <code>bin</code>.</p> <p><img src="/assets/img/ble_nus_bluefruit_6.d85f900a.png" alt="bluefruit data" title="BlueFruit data"></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/7/2019, 12:04:07 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hardware/hw_boards.html" class="prev">Boards</a></span> <span class="next"><a href="/hardware/hw_interface_usb.html">USB</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.5c9a409e.js" defer></script><script src="/assets/js/4.3a034228.js" defer></script><script src="/assets/js/12.4190be1d.js" defer></script><script src="/assets/js/28.72a68e7b.js" defer></script>
  </body>
</html>
